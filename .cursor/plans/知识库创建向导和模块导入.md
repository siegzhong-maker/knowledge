# 知识库创建向导和模块导入功能

## 目标
实现创建知识库的分步向导，支持用户创建新知识库、导入/定义模块结构，然后可以导入文档。

## 功能需求

### 1. 创建知识库分步向导
- **步骤1：基本信息**
  - 知识库名称（必填）
  - 描述（可选）
  - 图标选择（预设图标）
  - 颜色选择（预设颜色）
  
- **步骤2：模块结构**
  - 选项A：导入模块结构（上传JSON文件）
  - 选项B：手动定义模块结构（添加步骤和关卡）
  - 选项C：从模板创建（使用预设模板）
  
- **步骤3：完成**
  - 显示创建的知识库信息
  - 提供"开始导入文档"按钮

### 2. 模块结构导入格式
支持JSON格式导入，示例：
```json
{
  "steps": [
    {
      "stepNumber": 1,
      "stepName": "第一步",
      "checkpoints": [
        {
          "checkpointNumber": 1,
          "checkpointName": "关卡1",
          "description": "关卡描述"
        }
      ]
    }
  ]
}
```

### 3. 手动定义模块结构
- 添加步骤
- 为每个步骤添加关卡
- 支持编辑和删除

## 实现步骤

### 阶段1：后端API扩展

#### 1.1 模块批量创建API
**文件**: `backend/routes/modules.js`

新增端点：
- `POST /api/modules/batch` - 批量创建模块
  - 接收知识库ID和模块数组
  - 验证数据格式
  - 批量插入数据库

#### 1.2 模块结构验证
- 验证步骤编号连续性
- 验证关卡编号唯一性
- 验证必填字段

### 阶段2：前端向导实现

#### 2.1 创建知识库向导组件
**文件**: `frontend/js/knowledge-bases.js`

实现 `showCreateKnowledgeBaseWizard()` 函数：
- 步骤1：基本信息表单
- 步骤2：模块结构导入/定义
- 步骤3：完成确认

#### 2.2 模块结构导入功能
- JSON文件上传和解析
- 数据验证
- 预览导入的模块结构

#### 2.3 手动定义模块结构
- 动态添加步骤
- 动态添加关卡
- 实时预览

#### 2.4 模板系统
- 预设模板（如：产品设计5步、技术学习路径等）
- 模板选择界面

### 阶段3：UI优化

#### 3.1 向导样式
- 步骤指示器
- 表单验证提示
- 加载状态

#### 3.2 模块结构编辑器
- 拖拽排序（可选）
- 实时预览
- 数据验证提示

## 技术细节

### 模块结构JSON格式
```json
{
  "steps": [
    {
      "stepNumber": 1,
      "stepName": "步骤名称",
      "checkpoints": [
        {
          "checkpointNumber": 1,
          "checkpointName": "关卡名称",
          "description": "关卡描述（可选）"
        }
      ]
    }
  ]
}
```

### API设计
```javascript
// 批量创建模块
POST /api/modules/batch
Body: {
  knowledge_base_id: "kb-xxx",
  modules: [
    {
      step_number: 1,
      step_name: "步骤1",
      checkpoint_number: 1,
      checkpoint_name: "关卡1",
      description: "描述",
      order_index: 1
    }
  ]
}
```

### 前端状态管理
```javascript
const wizardState = {
  step: 1, // 当前步骤
  basicInfo: {}, // 基本信息
  modules: [], // 模块结构
  importMethod: null // 'import' | 'manual' | 'template'
}
```

## 文件清单

### 新建文件
- 无（在现有文件中扩展）

### 修改文件
- `backend/routes/modules.js` - 添加批量创建API
- `frontend/js/knowledge-bases.js` - 实现创建向导
- `frontend/index.html` - 添加向导UI（如果需要）

## 用户体验流程

1. 用户点击"新建知识库"
2. 显示步骤1：填写基本信息
3. 点击"下一步"进入步骤2
4. 选择导入方式：
   - 上传JSON文件
   - 手动定义
   - 选择模板
5. 预览/编辑模块结构
6. 点击"完成"创建知识库
7. 显示完成页面，提供"开始导入文档"按钮
8. 切换到新创建的知识库
9. 可以开始上传文档

## 注意事项
w
1. **数据验证**：确保模块结构数据完整和有效
2. **错误处理**：友好的错误提示
3. **进度保存**：支持中途退出，下次继续
4. **模板管理**：预设常用模板，方便用户快速创建

